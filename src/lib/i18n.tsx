import { createContext, useContext, ReactNode } from "react";
import { useLocalStorage } from "@/hooks/useLocalStorage";
import { fr, es, de, it, pt, enUS, type Locale } from "date-fns/locale";

export type Language = "en" | "fr" | "es" | "de" | "it" | "pt";

export const LANGUAGES: { code: Language; label: string }[] = [
  { code: "en", label: "English" },
  { code: "fr", label: "Français" },
  { code: "es", label: "Español" },
  { code: "de", label: "Deutsch" },
  { code: "it", label: "Italiano" },
  { code: "pt", label: "Português" },
];

const DATE_LOCALES: Record<Language, Locale> = { en: enUS, fr, es, de, it, pt };

const T: Record<Language, Record<string, string>> = {
  en: {
    "nav.timesheet": "Timesheet", "nav.week": "Week", "nav.settings": "Settings", "nav.send": "Export",
    "topbar.today": "Today",
    "client.title": "Client", "client.none": "No clients, add some in {link}Settings{/link}", "client.add": "Add a client",
    "activity.title": "Activity", "activity.none": "No activities, add some in {link}Settings{/link}", "activity.add": "Add",
    "timegrid.frozen": "Day locked",
    "export.title": "Export to CSV", "export.day": "Day", "export.week": "Week", "export.all": "All", "export.send": "Send",
    "settings.title": "Settings", "settings.clients": "Clients", "settings.activities": "Activities",
    "settings.hours": "Hours", "settings.language": "Language", "settings.add": "Add",
    "settings.edit_client": "Edit client", "settings.new_client": "New client",
    "settings.edit_activity": "Edit activity", "settings.new_activity": "New activity",
    "settings.name": "Name", "settings.color": "Color", "settings.notes": "Notes",
    "settings.active": "Active", "settings.save": "Save",
    "settings.label": "Label", "settings.short_code": "Short code (1-3 chars)",
    "settings.hours_desc": "Set the start and end of the work day. Only these hours will be displayed in the timesheet grid.",
    "settings.day_start": "Day start", "settings.day_end": "Day end", "settings.current_range": "Current range",
    "settings.delete_client": "Delete this client?", "settings.delete_activity": "Delete this activity?",
    "settings.delete_irreversible": "This action is irreversible.",
    "settings.cancel": "Cancel", "settings.delete": "Delete",
    "toast.name_required": "Name required", "toast.name_exists": "This name already exists",
    "toast.client_updated": "Client updated", "toast.client_added": "Client added",
    "toast.client_deleted": "Client deleted", "toast.client_delete_fail": "Cannot delete: entries exist for this client",
    "toast.label_required": "Label required", "toast.short_code_error": "Short code: 1-3 characters",
    "toast.activity_updated": "Activity updated", "toast.activity_added": "Activity added",
    "toast.activity_deleted": "Activity deleted", "toast.activity_delete_fail": "Cannot delete: entries exist for this activity",
    "toast.select_client_activity": "Select a client and an activity",
    "toast.auto_saved": "Data saved automatically",
    "toast.day_locked": "Day locked", "toast.day_unlocked": "Day unlocked",
    "index.unlock_title": "Unlock this day?",
    "index.unlock_desc": "This will allow editing entries for this day.",
    "index.unlock": "Unlock",
    "weekview.week_of": "Week of", "weekview.hour": "H",
    "notfound.title": "Page not found", "notfound.back": "Return to Home",
    "csv.date": "Date", "csv.client": "Client", "csv.activity": "Activity",
    "csv.start": "Start time", "csv.end": "End time", "csv.duration": "Duration (h)",
    "settings.client_name_placeholder": "Client name", "settings.activity_label_placeholder": "E.g. Development",
    "settings.notes_placeholder": "Optional notes",
  },
  fr: {
    "nav.timesheet": "Timesheet", "nav.week": "Semaine", "nav.settings": "Paramètres", "nav.send": "Envoyer",
    "topbar.today": "Auj.",
    "client.title": "Client", "client.none": "Aucun client, en ajouter dans les {link}Paramètres{/link}", "client.add": "Ajouter un client",
    "activity.title": "Activité", "activity.none": "Aucune activité, en ajouter dans les {link}Paramètres{/link}", "activity.add": "Ajouter",
    "timegrid.frozen": "Journée verrouillée",
    "export.title": "Exporter en CSV", "export.day": "Journée", "export.week": "Semaine", "export.all": "Tout", "export.send": "Envoyer",
    "settings.title": "Paramètres", "settings.clients": "Clients", "settings.activities": "Activités",
    "settings.hours": "Horaires", "settings.language": "Langue", "settings.add": "Ajouter",
    "settings.edit_client": "Modifier le client", "settings.new_client": "Nouveau client",
    "settings.edit_activity": "Modifier l'activité", "settings.new_activity": "Nouvelle activité",
    "settings.name": "Nom", "settings.color": "Couleur", "settings.notes": "Notes",
    "settings.active": "Actif", "settings.save": "Enregistrer",
    "settings.label": "Libellé", "settings.short_code": "Code court (1-3 car.)",
    "settings.hours_desc": "Définissez les heures de début et fin de journée. Seules ces heures seront affichées dans la grille du timesheet.",
    "settings.day_start": "Début de journée", "settings.day_end": "Fin de journée", "settings.current_range": "Plage actuelle",
    "settings.delete_client": "Supprimer ce client ?", "settings.delete_activity": "Supprimer cette activité ?",
    "settings.delete_irreversible": "Cette action est irréversible.",
    "settings.cancel": "Annuler", "settings.delete": "Supprimer",
    "toast.name_required": "Nom requis", "toast.name_exists": "Ce nom existe déjà",
    "toast.client_updated": "Client mis à jour", "toast.client_added": "Client ajouté",
    "toast.client_deleted": "Client supprimé", "toast.client_delete_fail": "Impossible: des entrées existent pour ce client",
    "toast.label_required": "Libellé requis", "toast.short_code_error": "Code court: 1-3 caractères",
    "toast.activity_updated": "Activité mise à jour", "toast.activity_added": "Activité ajoutée",
    "toast.activity_deleted": "Activité supprimée", "toast.activity_delete_fail": "Impossible: des entrées existent pour cette activité",
    "toast.select_client_activity": "Sélectionnez un client et une activité",
    "toast.auto_saved": "Données sauvegardées automatiquement",
    "toast.day_locked": "Journée verrouillée", "toast.day_unlocked": "Journée déverrouillée",
    "index.unlock_title": "Déverrouiller cette journée ?",
    "index.unlock_desc": "Cela permettra de modifier les entrées de cette journée.",
    "index.unlock": "Déverrouiller",
    "weekview.week_of": "Semaine du", "weekview.hour": "H",
    "notfound.title": "Page introuvable", "notfound.back": "Retour à l'accueil",
    "csv.date": "Date", "csv.client": "Client", "csv.activity": "Activité",
    "csv.start": "Heure début", "csv.end": "Heure fin", "csv.duration": "Durée (h)",
    "settings.client_name_placeholder": "Nom du client", "settings.activity_label_placeholder": "Ex: Développement",
    "settings.notes_placeholder": "Notes optionnelles",
  },
  es: {
    "nav.timesheet": "Horario", "nav.week": "Semana", "nav.settings": "Ajustes", "nav.send": "Enviar",
    "topbar.today": "Hoy",
    "client.title": "Cliente", "client.none": "Sin clientes, añadir en {link}Ajustes{/link}", "client.add": "Añadir cliente",
    "activity.title": "Actividad", "activity.none": "Sin actividades, añadir en {link}Ajustes{/link}", "activity.add": "Añadir",
    "timegrid.frozen": "Día bloqueado",
    "export.title": "Exportar a CSV", "export.day": "Día", "export.week": "Semana", "export.all": "Todo", "export.send": "Enviar",
    "settings.title": "Ajustes", "settings.clients": "Clientes", "settings.activities": "Actividades",
    "settings.hours": "Horarios", "settings.language": "Idioma", "settings.add": "Añadir",
    "settings.edit_client": "Editar cliente", "settings.new_client": "Nuevo cliente",
    "settings.edit_activity": "Editar actividad", "settings.new_activity": "Nueva actividad",
    "settings.name": "Nombre", "settings.color": "Color", "settings.notes": "Notas",
    "settings.active": "Activo", "settings.save": "Guardar",
    "settings.label": "Etiqueta", "settings.short_code": "Código corto (1-3 car.)",
    "settings.hours_desc": "Define las horas de inicio y fin del día laboral. Solo estas horas se mostrarán en la cuadrícula.",
    "settings.day_start": "Inicio del día", "settings.day_end": "Fin del día", "settings.current_range": "Rango actual",
    "settings.delete_client": "¿Eliminar este cliente?", "settings.delete_activity": "¿Eliminar esta actividad?",
    "settings.delete_irreversible": "Esta acción es irreversible.",
    "settings.cancel": "Cancelar", "settings.delete": "Eliminar",
    "toast.name_required": "Nombre requerido", "toast.name_exists": "Este nombre ya existe",
    "toast.client_updated": "Cliente actualizado", "toast.client_added": "Cliente añadido",
    "toast.client_deleted": "Cliente eliminado", "toast.client_delete_fail": "No se puede: existen entradas para este cliente",
    "toast.label_required": "Etiqueta requerida", "toast.short_code_error": "Código corto: 1-3 caracteres",
    "toast.activity_updated": "Actividad actualizada", "toast.activity_added": "Actividad añadida",
    "toast.activity_deleted": "Actividad eliminada", "toast.activity_delete_fail": "No se puede: existen entradas para esta actividad",
    "toast.select_client_activity": "Seleccione un cliente y una actividad",
    "toast.auto_saved": "Datos guardados automáticamente",
    "toast.day_locked": "Día bloqueado", "toast.day_unlocked": "Día desbloqueado",
    "index.unlock_title": "¿Desbloquear este día?",
    "index.unlock_desc": "Esto permitirá editar las entradas de este día.",
    "index.unlock": "Desbloquear",
    "weekview.week_of": "Semana del", "weekview.hour": "H",
    "notfound.title": "Página no encontrada", "notfound.back": "Volver al inicio",
    "csv.date": "Fecha", "csv.client": "Cliente", "csv.activity": "Actividad",
    "csv.start": "Hora inicio", "csv.end": "Hora fin", "csv.duration": "Duración (h)",
    "settings.client_name_placeholder": "Nombre del cliente", "settings.activity_label_placeholder": "Ej: Desarrollo",
    "settings.notes_placeholder": "Notas opcionales",
  },
  de: {
    "nav.timesheet": "Zeiterfassung", "nav.week": "Woche", "nav.settings": "Einstellungen", "nav.send": "Senden",
    "topbar.today": "Heute",
    "client.title": "Kunde", "client.none": "Keine Kunden, hinzufügen in {link}Einstellungen{/link}", "client.add": "Kunde hinzufügen",
    "activity.title": "Aktivität", "activity.none": "Keine Aktivitäten, hinzufügen in {link}Einstellungen{/link}", "activity.add": "Hinzufügen",
    "timegrid.frozen": "Tag gesperrt",
    "export.title": "Als CSV exportieren", "export.day": "Tag", "export.week": "Woche", "export.all": "Alles", "export.send": "Senden",
    "settings.title": "Einstellungen", "settings.clients": "Kunden", "settings.activities": "Aktivitäten",
    "settings.hours": "Arbeitszeiten", "settings.language": "Sprache", "settings.add": "Hinzufügen",
    "settings.edit_client": "Kunde bearbeiten", "settings.new_client": "Neuer Kunde",
    "settings.edit_activity": "Aktivität bearbeiten", "settings.new_activity": "Neue Aktivität",
    "settings.name": "Name", "settings.color": "Farbe", "settings.notes": "Notizen",
    "settings.active": "Aktiv", "settings.save": "Speichern",
    "settings.label": "Bezeichnung", "settings.short_code": "Kurzcode (1-3 Zeichen)",
    "settings.hours_desc": "Legen Sie Beginn und Ende des Arbeitstages fest. Nur diese Stunden werden im Raster angezeigt.",
    "settings.day_start": "Tagesbeginn", "settings.day_end": "Tagesende", "settings.current_range": "Aktueller Bereich",
    "settings.delete_client": "Diesen Kunden löschen?", "settings.delete_activity": "Diese Aktivität löschen?",
    "settings.delete_irreversible": "Diese Aktion kann nicht rückgängig gemacht werden.",
    "settings.cancel": "Abbrechen", "settings.delete": "Löschen",
    "toast.name_required": "Name erforderlich", "toast.name_exists": "Dieser Name existiert bereits",
    "toast.client_updated": "Kunde aktualisiert", "toast.client_added": "Kunde hinzugefügt",
    "toast.client_deleted": "Kunde gelöscht", "toast.client_delete_fail": "Nicht möglich: Es gibt Einträge für diesen Kunden",
    "toast.label_required": "Bezeichnung erforderlich", "toast.short_code_error": "Kurzcode: 1-3 Zeichen",
    "toast.activity_updated": "Aktivität aktualisiert", "toast.activity_added": "Aktivität hinzugefügt",
    "toast.activity_deleted": "Aktivität gelöscht", "toast.activity_delete_fail": "Nicht möglich: Es gibt Einträge für diese Aktivität",
    "toast.select_client_activity": "Wählen Sie einen Kunden und eine Aktivität",
    "toast.auto_saved": "Daten automatisch gespeichert",
    "toast.day_locked": "Tag gesperrt", "toast.day_unlocked": "Tag entsperrt",
    "index.unlock_title": "Diesen Tag entsperren?",
    "index.unlock_desc": "Dies ermöglicht das Bearbeiten der Einträge dieses Tages.",
    "index.unlock": "Entsperren",
    "weekview.week_of": "Woche vom", "weekview.hour": "St",
    "notfound.title": "Seite nicht gefunden", "notfound.back": "Zurück zur Startseite",
    "csv.date": "Datum", "csv.client": "Kunde", "csv.activity": "Aktivität",
    "csv.start": "Startzeit", "csv.end": "Endzeit", "csv.duration": "Dauer (St)",
    "settings.client_name_placeholder": "Kundenname", "settings.activity_label_placeholder": "Z.B. Entwicklung",
    "settings.notes_placeholder": "Optionale Notizen",
  },
  it: {
    "nav.timesheet": "Foglio ore", "nav.week": "Settimana", "nav.settings": "Impostazioni", "nav.send": "Invia",
    "topbar.today": "Oggi",
    "client.title": "Cliente", "client.none": "Nessun cliente, aggiungere in {link}Impostazioni{/link}", "client.add": "Aggiungi cliente",
    "activity.title": "Attività", "activity.none": "Nessuna attività, aggiungere in {link}Impostazioni{/link}", "activity.add": "Aggiungi",
    "timegrid.frozen": "Giorno bloccato",
    "export.title": "Esporta in CSV", "export.day": "Giorno", "export.week": "Settimana", "export.all": "Tutto", "export.send": "Invia",
    "settings.title": "Impostazioni", "settings.clients": "Clienti", "settings.activities": "Attività",
    "settings.hours": "Orari", "settings.language": "Lingua", "settings.add": "Aggiungi",
    "settings.edit_client": "Modifica cliente", "settings.new_client": "Nuovo cliente",
    "settings.edit_activity": "Modifica attività", "settings.new_activity": "Nuova attività",
    "settings.name": "Nome", "settings.color": "Colore", "settings.notes": "Note",
    "settings.active": "Attivo", "settings.save": "Salva",
    "settings.label": "Etichetta", "settings.short_code": "Codice breve (1-3 car.)",
    "settings.hours_desc": "Imposta l'inizio e la fine della giornata lavorativa. Solo queste ore saranno visualizzate nella griglia.",
    "settings.day_start": "Inizio giornata", "settings.day_end": "Fine giornata", "settings.current_range": "Intervallo attuale",
    "settings.delete_client": "Eliminare questo cliente?", "settings.delete_activity": "Eliminare questa attività?",
    "settings.delete_irreversible": "Questa azione è irreversibile.",
    "settings.cancel": "Annulla", "settings.delete": "Elimina",
    "toast.name_required": "Nome richiesto", "toast.name_exists": "Questo nome esiste già",
    "toast.client_updated": "Cliente aggiornato", "toast.client_added": "Cliente aggiunto",
    "toast.client_deleted": "Cliente eliminato", "toast.client_delete_fail": "Impossibile: esistono voci per questo cliente",
    "toast.label_required": "Etichetta richiesta", "toast.short_code_error": "Codice breve: 1-3 caratteri",
    "toast.activity_updated": "Attività aggiornata", "toast.activity_added": "Attività aggiunta",
    "toast.activity_deleted": "Attività eliminata", "toast.activity_delete_fail": "Impossibile: esistono voci per questa attività",
    "toast.select_client_activity": "Seleziona un cliente e un'attività",
    "toast.auto_saved": "Dati salvati automaticamente",
    "toast.day_locked": "Giorno bloccato", "toast.day_unlocked": "Giorno sbloccato",
    "index.unlock_title": "Sbloccare questo giorno?",
    "index.unlock_desc": "Ciò consentirà di modificare le voci di questo giorno.",
    "index.unlock": "Sblocca",
    "weekview.week_of": "Settimana del", "weekview.hour": "H",
    "notfound.title": "Pagina non trovata", "notfound.back": "Torna alla home",
    "csv.date": "Data", "csv.client": "Cliente", "csv.activity": "Attività",
    "csv.start": "Ora inizio", "csv.end": "Ora fine", "csv.duration": "Durata (h)",
    "settings.client_name_placeholder": "Nome del cliente", "settings.activity_label_placeholder": "Es: Sviluppo",
    "settings.notes_placeholder": "Note opzionali",
  },
  pt: {
    "nav.timesheet": "Folha de horas", "nav.week": "Semana", "nav.settings": "Configurações", "nav.send": "Enviar",
    "topbar.today": "Hoje",
    "client.title": "Cliente", "client.none": "Sem clientes, adicionar em {link}Configurações{/link}", "client.add": "Adicionar cliente",
    "activity.title": "Atividade", "activity.none": "Sem atividades, adicionar em {link}Configurações{/link}", "activity.add": "Adicionar",
    "timegrid.frozen": "Dia bloqueado",
    "export.title": "Exportar para CSV", "export.day": "Dia", "export.week": "Semana", "export.all": "Tudo", "export.send": "Enviar",
    "settings.title": "Configurações", "settings.clients": "Clientes", "settings.activities": "Atividades",
    "settings.hours": "Horários", "settings.language": "Idioma", "settings.add": "Adicionar",
    "settings.edit_client": "Editar cliente", "settings.new_client": "Novo cliente",
    "settings.edit_activity": "Editar atividade", "settings.new_activity": "Nova atividade",
    "settings.name": "Nome", "settings.color": "Cor", "settings.notes": "Notas",
    "settings.active": "Ativo", "settings.save": "Salvar",
    "settings.label": "Rótulo", "settings.short_code": "Código curto (1-3 car.)",
    "settings.hours_desc": "Defina o início e fim do dia de trabalho. Apenas essas horas serão exibidas na grade.",
    "settings.day_start": "Início do dia", "settings.day_end": "Fim do dia", "settings.current_range": "Intervalo atual",
    "settings.delete_client": "Excluir este cliente?", "settings.delete_activity": "Excluir esta atividade?",
    "settings.delete_irreversible": "Esta ação é irreversível.",
    "settings.cancel": "Cancelar", "settings.delete": "Excluir",
    "toast.name_required": "Nome obrigatório", "toast.name_exists": "Este nome já existe",
    "toast.client_updated": "Cliente atualizado", "toast.client_added": "Cliente adicionado",
    "toast.client_deleted": "Cliente excluído", "toast.client_delete_fail": "Impossível: existem entradas para este cliente",
    "toast.label_required": "Rótulo obrigatório", "toast.short_code_error": "Código curto: 1-3 caracteres",
    "toast.activity_updated": "Atividade atualizada", "toast.activity_added": "Atividade adicionada",
    "toast.activity_deleted": "Atividade excluída", "toast.activity_delete_fail": "Impossível: existem entradas para esta atividade",
    "toast.select_client_activity": "Selecione um cliente e uma atividade",
    "toast.auto_saved": "Dados salvos automaticamente",
    "toast.day_locked": "Dia bloqueado", "toast.day_unlocked": "Dia desbloqueado",
    "index.unlock_title": "Desbloquear este dia?",
    "index.unlock_desc": "Isso permitirá editar as entradas deste dia.",
    "index.unlock": "Desbloquear",
    "weekview.week_of": "Semana de", "weekview.hour": "H",
    "notfound.title": "Página não encontrada", "notfound.back": "Voltar ao início",
    "csv.date": "Data", "csv.client": "Cliente", "csv.activity": "Atividade",
    "csv.start": "Hora início", "csv.end": "Hora fim", "csv.duration": "Duração (h)",
    "settings.client_name_placeholder": "Nome do cliente", "settings.activity_label_placeholder": "Ex: Desenvolvimento",
    "settings.notes_placeholder": "Notas opcionais",
  },
};

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
  dateLocale: Locale;
}

const I18nContext = createContext<I18nContextType>(null!);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [language, setLanguage] = useLocalStorage<Language>("ts-language", "fr");
  const t = (key: string) => T[language]?.[key] || T.en[key] || key;
  const dateLocale = DATE_LOCALES[language];

  return (
    <I18nContext.Provider value={{ language, setLanguage, t, dateLocale }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useTranslation() {
  return useContext(I18nContext);
}
